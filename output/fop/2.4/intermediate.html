<!DOCTYPE html>
<html lang="en">
  <head>


    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta property="og:image" content="http://www.apache.org/images/asf_logo.gif" />
<!--
    <link rel="stylesheet" type="text/css" media="screen" href="http://www.apache.org/css/style.css">
-->
    <link rel="stylesheet" type="text/css" media="screen" href="https://www.apache.org/css/code.css">
    <link href="/css/profile.css" rel="stylesheet" type="text/css" />
    <link href="/css/xmlgraphics.css" rel="stylesheet" type="text/css" />
    <link href="/css/print.css" rel="stylesheet" type="text/css" media="print" />

    <script src="https://code.jquery.com/jquery.min.js"></script>
	<script type="text/javascript" src="/js/jquery.stoc.js"></script>
    <script>
    $(document).ready(function(){
        $('ul#navigation a').each(function() {
		    if (this.href === window.location.href)
			    { $(this). attr('id', 'forefront');} 
        });
        $('ul#navigation a#forefront').each(function() {
        	
        });
    })
	$(function(){
		$("#items").stoc({ search: "#content", stocTitle: "<h3>Page Contents</h3>" });
	});
    </script>



	<style>
	.highlight {color: red;}
	</style>

  </head>

  <body>

	<div id="banner">&nbsp;
	</div>

	<div id="navigation">
[![Apache XML Graphics Project Logo](/images/apache-xml-graphics.gif "Apache XML Graphics Project")](/)

# Apache&trade; FOP
  - [FOP Home](/fop/)
  - [Download](/fop/download.html)
  - [Quick Start Guide](/fop/quickstartguide.html)
  - [Compliance](/fop/compliance.html)
  - [Getting Help](/fop/gethelp.html)
  - [FAQs](/fop/faq.html)
  - [FOP Wiki](https://cwiki.apache.org/confluence/display/XMLGRAPHICSFOP)
  - [Mailing Lists](/fop/maillist.html)
  - [License](/fop/license.html)
  - ## Resources
    - [XSL-FO](/fop/fo.html)
    - [Examples](/fop/examples.html)
    - [Bugs](/fop/bugs.html)
    - [Wiki](https://cwiki.apache.org/confluence/display/XMLGRAPHICSFOP/FrontPage)
    - [Other](/fop/resources.html)
  - ## Project
    - [News](/fop/news.html)
    - [Who We Are](/fop/team.html)
    - [Status](/fop/status.html)
    - [Known Issues](/fop/knownissues.html)
    - [Changes](/fop/changes.html)
  - ## Versions
      - ## FOP Trunk (dev)
          - [Overview](/fop/trunk/)
          - [Upgrading](/fop/trunk/upgrading.html)
          - ### Using Apache&trade; FOP
            - [Build](/fop/trunk/compiling.html)
            - [Configure](/fop/trunk/configuration.html)
            - [Run](/fop/trunk/running.html)
            - [Embed](/fop/trunk/embedding.html)
            - [Servlets](/fop/trunk/servlets.html)
            - [Ant Task](/fop/trunk/anttask.html)
          - ### Features
            - [Accessibility](/fop/trunk/accessibility.html)
            - [Complex Scripts](/fop/trunk/complexscripts.html)
            - [Events](/fop/trunk/events.html)
            - [Extensions](/fop/trunk/extensions.html)
            - [Fonts](/fop/trunk/fonts.html)
            - [Graphics](/fop/trunk/graphics.html)
            - [Hyphenation](/fop/trunk/hyphenation.html)
            - [Intermediate Format](/fop/trunk/intermediate.html)
            - [Metadata](/fop/trunk/metadata.html)
            - [Output Targets](/fop/trunk/output.html)
            - [PDF/A](/fop/trunk/pdfa.html)
            - [PDF/X](/fop/trunk/pdfx.html)
            - [PDF Encryption](/fop/trunk/pdfencryption.html)
            - [PDF Images](/fop/fop-pdf-images.html)
            - [Whitespace Management](/fop/trunk/whitespacemanagement.html)
      - ## FOP 2.5
          - [FOP 2.5 Overview](/fop/2.5/)
          - [Release Notes](/fop/2.5/releaseNotes_2.5.html)
          - [Changes (2.5)](/fop/2.5/changes_2.5.html)
          - [Known Issues](/fop/2.5/knownissues_overview.html)
          - [Upgrading](/fop/2.5/upgrading.html)
          - ### Using Apache FOP 2.5
            - [Build](/fop/2.5/compiling.html)
            - [Configure](/fop/2.5/configuration.html)
            - [Run](/fop/2.5/running.html)
            - [Embed](/fop/2.5/embedding.html)
            - [Servlets](/fop/2.5/servlets.html)
            - [Ant Task](/fop/2.5/anttask.html)
          - ### Features
            - [Accessibility](/fop/2.5/accessibility.html)
            - [Complex Scripts](/fop/2.5/complexscripts.html)
            - [Events](/fop/2.5/events.html)
            - [Extensions](/fop/2.5/extensions.html)
            - [Fonts](/fop/2.5/fonts.html)
            - [Graphics](/fop/2.5/graphics.html)
            - [Hyphenation](/fop/2.5/hyphenation.html)
            - [Intermediate Format](/fop/2.5/intermediate.html)
            - [Metadata](/fop/2.5/metadata.html)
            - [Output Targets](/fop/2.5/output.html)
            - [PDF/A](/fop/2.5/pdfa.html)
            - [PDF/X](/fop/2.5/pdfx.html)
            - [PDF Encryption](/fop/2.5/pdfencryption.html)
            - [PDF Images](/fop/fop-pdf-images.html)
            - [Whitespace Management](/fop/2.5/whitespacemanagement.html)     
      - ## FOP 2.4
          - [FOP 2.4 Overview](/fop/2.4/)
          - [Release Notes](/fop/2.4/releaseNotes_2.4.html)
          - [Changes (2.4)](/fop/2.4/changes_2.4.html)
          - [Known Issues](/fop/2.4/knownissues_overview.html)
          - [Upgrading](/fop/2.4/upgrading.html)
          - ### Using Apache FOP 2.4
            - [Build](/fop/2.4/compiling.html)
            - [Configure](/fop/2.4/configuration.html)
            - [Run](/fop/2.4/running.html)
            - [Embed](/fop/2.4/embedding.html)
            - [Servlets](/fop/2.4/servlets.html)
            - [Ant Task](/fop/2.4/anttask.html)
          - ### Features
            - [Accessibility](/fop/2.4/accessibility.html)
            - [Complex Scripts](/fop/2.4/complexscripts.html)
            - [Events](/fop/2.4/events.html)
            - [Extensions](/fop/2.4/extensions.html)
            - [Fonts](/fop/2.4/fonts.html)
            - [Graphics](/fop/2.4/graphics.html)
            - [Hyphenation](/fop/2.4/hyphenation.html)
            - [Intermediate Format](/fop/2.4/intermediate.html)
            - [Metadata](/fop/2.4/metadata.html)
            - [Output Targets](/fop/2.4/output.html)
            - [PDF/A](/fop/2.4/pdfa.html)
            - [PDF/X](/fop/2.4/pdfx.html)
            - [PDF Encryption](/fop/2.4/pdfencryption.html)
            - [PDF Images](/fop/fop-pdf-images.html)
            - [Whitespace Management](/fop/2.4/whitespacemanagement.html)             
      - ## FOP 2.3
          - [FOP 2.3 Overview](/fop/2.3/)
          - [Release Notes](/fop/2.3/releaseNotes_2.3.html)
          - [Changes (2.3)](/fop/2.3/changes_2.3.html)
          - [Known Issues](/fop/2.3/knownissues_overview.html)
          - [Upgrading](/fop/2.3/upgrading.html)
          - ### Using Apache FOP 2.3
            - [Build](/fop/2.3/compiling.html)
            - [Configure](/fop/2.3/configuration.html)
            - [Run](/fop/2.3/running.html)
            - [Embed](/fop/2.3/embedding.html)
            - [Servlets](/fop/2.3/servlets.html)
            - [Ant Task](/fop/2.3/anttask.html)
          - ### Features
            - [Accessibility](/fop/2.3/accessibility.html)
            - [Complex Scripts](/fop/2.3/complexscripts.html)
            - [Events](/fop/2.3/events.html)
            - [Extensions](/fop/2.3/extensions.html)
            - [Fonts](/fop/2.3/fonts.html)
            - [Graphics](/fop/2.3/graphics.html)
            - [Hyphenation](/fop/2.3/hyphenation.html)
            - [Intermediate Format](/fop/2.3/intermediate.html)
            - [Metadata](/fop/2.3/metadata.html)
            - [Output Targets](/fop/2.3/output.html)
            - [PDF/A](/fop/2.3/pdfa.html)
            - [PDF/X](/fop/2.3/pdfx.html)
            - [PDF Encryption](/fop/2.3/pdfencryption.html)
            - [PDF Images](/fop/fop-pdf-images.html)
            - [Whitespace Management](/fop/2.3/whitespacemanagement.html)            
      - ## FOP 2.2
          - [FOP 2.2 Overview](/fop/2.2/)
          - [Release Notes](/fop/2.2/releaseNotes_2.2.html)
          - [Changes (2.2)](/fop/2.2/changes_2.2.html)
          - [Known Issues](/fop/2.2/knownissues_overview.html)
          - [Upgrading](/fop/2.2/upgrading.html)
          - ### Using Apache FOP 2.2
            - [Build](/fop/2.2/compiling.html)
            - [Configure](/fop/2.2/configuration.html)
            - [Run](/fop/2.2/running.html)
            - [Embed](/fop/2.2/embedding.html)
            - [Servlets](/fop/2.2/servlets.html)
            - [Ant Task](/fop/2.2/anttask.html)
          - ### Features
            - [Accessibility](/fop/2.2/accessibility.html)
            - [Complex Scripts](/fop/2.2/complexscripts.html)
            - [Events](/fop/2.2/events.html)
            - [Extensions](/fop/2.2/extensions.html)
            - [Fonts](/fop/2.2/fonts.html)
            - [Graphics](/fop/2.2/graphics.html)
            - [Hyphenation](/fop/2.2/hyphenation.html)
            - [Intermediate Format](/fop/2.2/intermediate.html)
            - [Metadata](/fop/2.2/metadata.html)
            - [Output Targets](/fop/2.2/output.html)
            - [PDF/A](/fop/2.2/pdfa.html)
            - [PDF/X](/fop/2.2/pdfx.html)
            - [PDF Encryption](/fop/2.2/pdfencryption.html)
            - [PDF Images](/fop/fop-pdf-images.html)
            - [Whitespace Management](/fop/2.2/whitespacemanagement.html)
      - ## FOP 2.1
          - [FOP 2.1 Overview](/fop/2.1/)
          - [Release Notes](/fop/2.1/releaseNotes_2.1.html)
          - [Changes (2.1)](/fop/2.1/changes_2.1.html)
          - [Known Issues](/fop/2.1/knownissues_overview.html)
          - [Upgrading](/fop/2.1/upgrading.html)
          - ### Using Apache FOP 2.1
            - [Build](/fop/2.1/compiling.html)
            - [Configure](/fop/2.1/configuration.html)
            - [Run](/fop/2.1/running.html)
            - [Embed](/fop/2.1/embedding.html)
            - [Servlets](/fop/2.1/servlets.html)
            - [Ant Task](/fop/2.1/anttask.html)
          - ### Features
            - [Accessibility](/fop/2.1/accessibility.html)
            - [Complex Scripts](/fop/2.1/complexscripts.html)
            - [Events](/fop/2.1/events.html)
            - [Extensions](/fop/2.1/extensions.html)
            - [Fonts](/fop/2.1/fonts.html)
            - [Graphics](/fop/2.1/graphics.html)
            - [Hyphenation](/fop/2.1/hyphenation.html)
            - [Intermediate Format](/fop/2.1/intermediate.html)
            - [Metadata](/fop/2.1/metadata.html)
            - [Output Targets](/fop/2.1/output.html)
            - [PDF/A](/fop/2.1/pdfa.html)
            - [PDF/X](/fop/2.1/pdfx.html)
            - [PDF Encryption](/fop/2.1/pdfencryption.html)
            - [PDF Images](/fop/fop-pdf-images.html)
            - [Whitespace Management](/fop/2.1/whitespacemanagement.html)
      - ## FOP 2.0
          - [FOP 2.0 Overview](/fop/2.0/)
          - [Release Notes](/fop/2.0/releaseNotes_2.0.html)
          - [Changes (2.0)](/fop/2.0/changes_2.0.html)
          - [Known Issues](/fop/2.0/knownissues_overview.html)
          - [Upgrading](/fop/2.0/upgrading.html)
          - ### Using Apache FOP 2.0
            - [Build](/fop/2.0/compiling.html)
            - [Configure](/fop/2.0/configuration.html)
            - [Run](/fop/2.0/running.html)
            - [Embed](/fop/2.0/embedding.html)
            - [Servlets](/fop/2.0/servlets.html)
            - [Ant Task](/fop/2.0/anttask.html)
          - ### Features
            - [Accessibility](/fop/2.0/accessibility.html)
            - [Complex Scripts](/fop/2.0/complexscripts.html)
            - [Events](/fop/2.0/events.html)
            - [Extensions](/fop/2.0/extensions.html)
            - [Fonts](/fop/2.0/fonts.html)
            - [Graphics](/fop/2.0/graphics.html)
            - [Hyphenation](/fop/2.0/hyphenation.html)
            - [Intermediate Format](/fop/2.0/intermediate.html)
            - [Metadata](/fop/2.0/metadata.html)
            - [Output Targets](/fop/2.0/output.html)
            - [PDF/A](/fop/2.0/pdfa.html)
            - [PDF/X](/fop/2.0/pdfx.html)
            - [PDF Encryption](/fop/2.0/pdfencryption.html)
            - [PDF Images](/fop/fop-pdf-images.html)
            - [Whitespace Management](/fop/2.0/whitespacemanagement.html)
      - ## FOP 1.1
          - [FOP 1.1 Overview](/fop/1.1/)
          - [Release Notes](/fop/1.1/releaseNotes_1.1.html)
          - [Changes (1.1)](/fop/1.1/changes_1.1.html)
          - [Known Issues](/fop/1.1/knownissues_overview.html)
          - [Upgrading](/fop/1.1/upgrading.html)
          - ### Using Apache FOP 1.1
            - [Build](/fop/1.1/compiling.html)
            - [Configure](/fop/1.1/configuration.html)
            - [Run](/fop/1.1/running.html)
            - [Embed](/fop/1.1/embedding.html)
            - [Servlets](/fop/1.1/servlets.html)
            - [Ant Task](/fop/1.1/anttask.html)
          - ### Features
            - [Accessibility](/fop/1.1/accessibility.html)
            - [Complex Scripts](/fop/1.1/complexscripts.html)
            - [Events](/fop/1.1/events.html)
            - [Extensions](/fop/1.1/extensions.html)
            - [Fonts](/fop/1.1/fonts.html)
            - [Graphics](/fop/1.1/graphics.html)
            - [Hyphenation](/fop/1.1/hyphenation.html)
            - [Intermediate Format](/fop/1.1/intermediate.html)
            - [Metadata](/fop/1.1/metadata.html)
            - [Output Targets](/fop/1.1/output.html)
            - [PDF/A](/fop/1.1/pdfa.html)
            - [PDF/X](/fop/1.1/pdfx.html)
            - [PDF Encryption](/fop/1.1/pdfencryption.html)
      - ## FOP 1.0
          - [FOP 1.0 Overview](/fop/1.0/)
          - [Release Notes](/fop/1.0/releaseNotes_1.0.html)
          - [Changes (1.0)](/fop/1.0/changes_1.0.html)
          - [Known Issues](/fop/1.0/knownissues_overview.html)
          - [Upgrading](/fop/1.0/upgrading.html)
          - ### Using Apache FOP 1.0
            - [Build](/fop/1.0/compiling.html)
            - [Configure](/fop/1.0/configuration.html)
            - [Run](/fop/1.0/running.html)
            - [Embed](/fop/1.0/embedding.html)
            - [Servlets](/fop/1.0/servlets.html)
            - [Ant Task](/fop/1.0/anttask.html)
          - ### Features
            - [Output Targets](/fop/1.0/output.html)
            - [Intermediate Format](/fop/1.0/intermediate.html)
            - [PDF Encryption](/fop/1.0/pdfencryption.html)
            - [PDF/A](/fop/1.0/pdfa.html)
            - [PDF/X](/fop/1.0/pdfx.html)
            - [Graphics](/fop/1.0/graphics.html)
            - [Fonts](/fop/1.0/fonts.html)
            - [Hyphenation](/fop/1.0/hyphenation.html)
            - [Extensions](/fop/1.0/extensions.html)
            - [Events](/fop/1.0/events.html)
            - [Metadata](/fop/1.0/metadata.html)
            - [Accessibility](/fop/1.0/accessibility.html)
      - ## FOP Development
          - [General Info](/fop/dev/)
          - ## Design
            - [Design Info](/fop/dev/design/)
          - ## Core Process
            - [Startup](/fop/dev/design/startup.html)
            - [XML Parsing](/fop/dev/design/parsing.html)
            - [FO Tree](/fop/dev/design/fotree.html)
            - [Properties](/fop/dev/design/properties.html)
            - [Layout](/fop/dev/design/layout.html)
            - [Break Possibility](/fop/dev/design/breakpos.html)
            - [Area Tree](/fop/dev/design/areas.html)
            - [Renderers](/fop/dev/design/renderers.html)
          - ## Miscellaneous
            - [Images](/fop/dev/design/images.html)
            - [PDF Library](/fop/dev/design/pdf-library.html)
            - [SVG](/fop/dev/design/svg.html)
            - [Embedding](/fop/dev/design/embedding.html)
            - [Extending](/fop/dev/design/extending.html)
            - [Optimisations](/fop/dev/design/optimise.html)
            - [User Agent](/fop/dev/design/useragent.html)
          - [Unresolved (Wiki)](https://cwiki.apache.org/confluence/display/XMLGRAPHICSFOP/FOPProjectPages)
          - [SVG](/fop/dev/svg.html)
          - [Extensions](/fop/dev/extensions.html)
          - ## Develop
            - [Walk-Thru](/fop/dev/implement.html)
            - [Patch Queue](https://issues.apache.org/jira/issues/?jql=project%20%3D%20FOP%20AND%20description%20~%20%22\%22[patch]\%22%22%20AND%20status%20in%20%28Open%2C%20%22In%20Progress%22%2C%20Reopened%29)
            - [Conventions](/fop/dev/conventions.html)
          - ## Test
            - [Testing](/fop/dev/testing.html)
          - ## Deploy
            - [Doc Mgmt](/fop/dev/doc.html)
            - [Release](/fop/dev/release.html)
            - [Bugs](https://issues.apache.org/jira/issues/?jql=project%20%3D%20FOP%20AND%20issuetype%20%3D%20Bug%20AND%20status%20in%20%28Open%2C%20%22In%20Progress%22%2C%20Reopened%29)
          - ## Resources
            - [FAQs](/fop/dev/faq.html)
            - [Tools](/fop/dev/tools.html)
            - [ViewVC](http://svn.apache.org/viewvc/xmlgraphics/fop)
          - ## SubPackages
            - [RTFlib](/fop/dev/rtflib.html)

# Apache&trade; XML Graphics
  - ## Project Overview
    - [Who We Are](/team.html)
    - [Legal Stuff](/legal.html)
    - [Project Charter](/charter.html)
    - [Mailing Lists](/mail.html)
    - [Code Repositories](/repo.html)
    - [ASF Sponsorship Program](https://www.apache.org/foundation/sponsorship.html)
    - [ASF Thanks](https://www.apache.org/foundation/thanks.html)
    - [Licenses](https://www.apache.org/licenses/)
    - [Apache XML Graphics Security](/security.html)
    - [ASF Security](https://www.apache.org/security/)

# Sub Projects
  - [Apache Batik](/batik/)
  - [Apache XML Graphics Commons](/commons/)

### Search Apache XML Graphics

<form name="search" id="search" action="https://www.google.com/search" method="get">
  <input value="xmlgraphics.apache.org" name="sitesearch" type="hidden"/>
  <input type="text" name="q" id="query" />
  <input type="submit" id="submit" value="Search" />
</form>

### ApacheCon N. America

<a title="ApacheCon North America" href="https://www.apachecon.com"><img class="apachecon_logo" alt="ApacheCon North America" src="https://www.apachecon.com/images/landingpage/apachecon-logo.png" width="200" /></a><br /><br />

  * **[ApacheCon NA](https://www.apachecon.com/)**

Hope to see you there!

### ApacheCon Europe

<a title="ApacheCon Europe" href="https://www.apachecon.com"><img class="apachecon_logo" alt="ApacheCon Europe" src="https://www.apachecon.com/images/landingpage/apachecon-logo.png" width="200" /></a><br /><br />

  * **[ApacheCon Europe](https://www.apachecon.com/)**

Hope to see you there!

<a title="Apache Software Foundation" href="https://www.apache.org"><img id="asf_logo_url" alt="Apache Software Foundation " src="/images/asf_logo_url.png" width="200" /></a><br /><br />

<a title="Support the Apache Software Foundation" href="https://donate.apache.org/"><img id="asf_support_url" alt="Support the Apache Software Foundation " src="https://blogs.apache.org/foundation/mediaresource/d67ca611-a57c-462d-ac23-95063f81d175" width="200" /></a>

<script>
$(document).ready(function () {
    $('#navigation :header').click(function () {
        var text = $(this).siblings('ul');
        if (text.is(':hidden')) {
            text.slideDown('200');
        } else {
            text.slideUp('200');
        }
    });
    if ($('#navigation :header').siblings('ul')) {
      $('#navigation :header').not('#search-apache-xml-graphics, #apachewzxhzdk3-xml-graphics, #sub-projects').append(' &raquo;');
    }
  $('#navigation > ul > li > ul > li ul').hide();
  $('#project-overview').next().hide();
  $('#versions').next().show();
  var str=location.href.toLowerCase();
  $("#navigation li a").each(function() {
    if (str.indexOf(this.href.toLowerCase()) > -1) {
      $(this).parents().slideDown('200');
      $("li.highlight").removeClass("highlight");
      $(this).parent().addClass("highlight");
    }
  });
})
</script>	</div>

	<div id="bannertext" style="border-bottom: 2px dashed #666666; height: 70px;">
	  <a href="/fop/"><img src="/images/apache-fop-logo.jpg" alt="The Apache FOP Project" width="120" height="65" style="float:left; margin-right: 15px;" /></a>
	  <h2>The Apache&trade; FOP Project</h2>
	</div>  

    <h1>Apache(tm) FOP: Intermediate Format</h1>
    Translations: 
<a href="/fop/2.0/intermediate.html">en</a>
<a href="/fop/0.95/intermediate.html">en</a>
<a href="/fop/2.5/intermediate.html">en</a>
<a href="/fop/trunk/intermediate.html">en</a>
<a href="/fop/1.1/intermediate.html">en</a>
<a href="/fop/2.2/intermediate.html">en</a>
<a href="/fop/2.1/intermediate.html">en</a>
<a href="/fop/2.3/intermediate.html">en</a>
<a href="/fop/1.0/intermediate.html">en</a>


    <h1>Apache&trade; FOP: Intermediate Format</h1>
<p><note>Please note that the intermediate formats described here are <strong>advanced features</strong> and can be ignored by most users of Apache&trade; FOP.</note></p>
<h2 id="introduction">Introduction</h2>
<p>Apache&trade; FOP now provides two different so-called intermediate formats. The first one (let's call it the area tree XML format) is basically a 1:1 XML representation of FOP's area tree as generated by the layout engine. The area tree is conceptually defined in the <a href="http://www.w3.org/TR/2001/REC-xsl-20011015/slice1.html#section-N742-Formatting">XSL-FO specification in chapter 1.1.2</a>. Even though the area tree is mentioned in the XSL-FO specification, this part is not standardized. Therefore, the area tree XML format is a FOP-proprietary XML file format. The area tree XML can be generated through the area tree XML Renderer (the XMLRenderer).</p>
<p>The second intermediate format (which we shall name exactly like this: the intermediate format) is a recent addition which tries to meet a slightly different set of goals. It is highly optimized for speed.</p>
<p>The intermediate format can be used to generate intermediate documents that are modified before they are finally rendered to their ultimate output format. Modifications include adjusting and changing trait values, adding or modifying area objects, inserting prefabricated pages, overlays, imposition (n-up, rotation, scaling etc.). Multiple IF files can be combined to a single output file.</p>
<h2 id="which-if">Which Intermediate Format to choose?</h2>
<p>Both formats have their use cases, so the choice you will make will depend on your particular situation. Here is a list of strengths and use cases for both formats:</p>
<h3 id="strengths-at">Area Tree XML (AT XML)</h3>
<ul>
<li>
<p>1:1 representation of FOP's area tree in XML.</p>
</li>
<li>
<p>Contains more structure information than the new intermediate format.</p>
</li>
<li>
<p>Used in FOP's layout engine test suite for regression testing.</p>
</li>
</ul>
<h3 id="strengths-if">Intermediate Format (IF)</h3>
<ul>
<li>
<p>Highly optimized for speed.</p>
</li>
<li>
<p>Smaller XML files.</p>
</li>
<li>
<p>Easier to post-process.</p>
</li>
<li>
<p>XML Schema is available.</p>
</li>
<li>
<p>Recommended for use cases where documents are formatted concurrently and later concatenated to a single print job.</p>
</li>
</ul>
<p>More technical information about the two formats can be found on the <a href="https://cwiki.apache.org/confluence/display/XMLGRAPHICSFOP/AreaTreeIntermediateXml/NewDesign">FOP Wiki</a>.</p>
<h2 id="architecture">Architectural Overview</h2>
<p><img alt="Diagram with an architectural overview over the intermediate formats" src="images/if-architecture-overview.png"></p>
<h2 id="usage">Usage of the Area Tree XML format (AT XML)</h2>
<p>As already mentioned, the area tree XML format is generated by using the <strong>XMLRenderer</strong> (MIME type: <strong>application/X-fop-areatree</strong>). So, you basically set the right MIME type for the output format and process your FO files as if you would create a PDF file.</p>
<p>However, there is an important detail to consider: The various Renderers don't all use the same font sources. To be able to create the right area tree for the ultimate output format, you need to create the area tree XML file using the right font setup. This is achieved by telling the XMLRenderer to mimic another renderer. This is done by calling the XMLRenderer's mimicRenderer() method with an instance of the ultimate target renderer as the single parameter. This has a consequence: An area tree XML file rendered with the Java2DRenderer may not look as expected when it was actually generated for the PDF renderer. For renderers that use the same font setup, this restriction does not apply (PDF and PS, for example). Generating the area tree XML format file is the first step.</p>
<p>The second step is to reparse the file using the <strong>AreaTreeParser</strong> which is found in the org.apache.fop.area package. The pages retrieved from the area tree XML file are added to an AreaTreeModel instance from where they are normally rendered using one of the available Renderer implementations. You can find examples for the area tree XML processing in the <a href="http://svn.apache.org/viewvc/xmlgraphics/fop/trunk/fop/examples/embedding/java/embedding/intermediate/">http://svn.apache.org/viewvc/xmlgraphics/fop/trunk/fop/examples/embedding/java/embedding/intermediate/</a> directory in the FOP distribution.</p>
<p>The basic pattern to parse the area tree XML format looks like this:</p>
<div class="highlight"><pre><span></span><span class="n">FopFactory</span> <span class="n">fopFactory</span> <span class="o">=</span> <span class="n">FopFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;.&quot;</span><span class="o">).</span><span class="na">toURI</span><span class="o">());</span>

<span class="c1">// Setup output</span>
<span class="n">OutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">FileOutputStream</span><span class="o">(</span><span class="n">pdffile</span><span class="o">);</span>
<span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">BufferedOutputStream</span><span class="o">(</span><span class="n">out</span><span class="o">);</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="c1">//Setup fonts and user agent</span>
    <span class="n">FontInfo</span> <span class="n">fontInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FontInfo</span><span class="o">();</span>
    <span class="n">FOUserAgent</span> <span class="n">userAgent</span> <span class="o">=</span> <span class="n">fopFactory</span><span class="o">.</span><span class="na">newFOUserAgent</span><span class="o">();</span>

    <span class="c1">//Construct the AreaTreeModel that will received the individual pages</span>
    <span class="n">AreaTreeModel</span> <span class="n">treeModel</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RenderPagesModel</span><span class="o">(</span><span class="n">userAgent</span><span class="o">,</span>
            <span class="n">MimeConstants</span><span class="o">.</span><span class="na">MIME_PDF</span><span class="o">,</span> <span class="n">fontInfo</span><span class="o">,</span> <span class="n">out</span><span class="o">);</span>

    <span class="c1">//Parse the area tree file into the area tree</span>
    <span class="n">AreaTreeParser</span> <span class="n">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AreaTreeParser</span><span class="o">();</span>
    <span class="n">Source</span> <span class="n">src</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StreamSource</span><span class="o">(</span><span class="n">myIFFile</span><span class="o">);</span>
    <span class="n">parser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">src</span><span class="o">,</span> <span class="n">treeModel</span><span class="o">,</span> <span class="n">userAgent</span><span class="o">);</span>

    <span class="c1">//Signal the end of the processing. The renderer can finalize the target document.</span>
    <span class="n">treeModel</span><span class="o">.</span><span class="na">endDocument</span><span class="o">();</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
    <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>


<p>This example simply reads an area tree file and renders it to a PDF file. Please note, that in normal FOP operation you're shielded from having to instantiate the FontInfo object yourself. This is normally a task of the AreaTreeHandler which is not present in this scenario. The same applies to the AreaTreeModel instance, in this case an instance of a subclass called RenderPagesModel. RenderPagesModel is ideal in this case as it has very little overhead processing the individual pages. An important line in the example is the call to <code>endDocument()</code> on the AreaTreeModel. This lets the Renderer know that the processing is now finished.</p>
<p>The area tree XML format can also be used from the <a href="running.html#standalone-start">command-line</a> by using the "-atin" parameter for specifying the area tree XML as input file. You can also specify a "mimic renderer" by inserting a MIME type between "-at" and the output file.</p>
<h3 id="concat">Concatenating Documents</h3>
<p>This initial example is obviously not very useful. It would be faster to create the PDF file directly. As the <a href="http://svn.apache.org/repos/asf/xmlgraphics/fop/trunk/fop/examples/embedding/java/embedding/atxml/ExampleConcat.java">ExampleConcat.java</a> example shows you can easily parse multiple area tree files in a row and add the parsed pages to the same AreaTreeModel instance which essentially concatenates all the input document to one single output document.</p>
<h3 id="modifying">Modifying Documents</h3>
<p>One of the most important use cases for this format is obviously modifying the area tree XML before finally rendering it to the target format. You can easily use XSLT to process the AT XML file according to your needs. Please note, that we will currently not formally describe the area tree XML format. You need to have a good understanding its structure so you don't create any non-parseable files. We may add an XML Schema and more detailed documentation at a later time. You're invited to help us with that.</p>
<p><note>The area tree XML format is sensitive to changes in whitespace. If you're not careful, the modified file may not render correctly.</note></p>
<h3 id="advanced">Advanced Use</h3>
<p>The generation of the area tree format as well as it parsing process has been designed to allow for maximum flexibility and optimization. Please note that you can call <code>setTransformerHandler()</code> on XMLRenderer to give the XMLRenderer your own TransformerHandler instance in case you would like to do custom serialization (to a W3C DOM, for example) and/or to directly modify the area tree using XSLT. The AreaTreeParser on the other side allows you to retrieve a ContentHandler instance where you can manually send SAX events to to start the parsing process (see <code>getContentHandler()</code>).</p>
<h2 id="usage-if">Usage of the Intermediate Format (IF)</h2>
<p>The Intermediate Format (IF) is generated by the <strong>IFSerializer</strong> (MIME type: <strong>application/X-fop-intermediate-format</strong>). So, you basically set the right MIME type for the output format and process your FO files as if you would create a PDF file.</p>
<p>The IFSerializer is an implementation of the <strong>IFDocumentHandler</strong> and <strong>IFPainter</strong> interfaces. The <strong>IFRenderer</strong> class is responsible for converting FOP's area tree into calls against these two interfaces.</p>
<ul>
<li>
<p>IFDocumentHandler: This interface is used on the document-level and defines the overall structure of the Intermediate Format.</p>
</li>
<li>
<p>IFPainter: This interface is used to generate graphical page content like text, images and borders.</p>
</li>
</ul>
<p>As with the AT XML, there is an important detail to consider: The various output implementations don't all use the same font sources. To be able to create the right IF for the ultimate output file, you need to create the IF file using the right font setup. This is achieved by telling the IFRenderer (responsible for converting the area tree into calls to the IFDocumentHandler and IFPainter interfaces) to mimic another renderer. This is done by calling the IFSerializer's mimicDocumentHandler() method with an instance of the ultimate target document handler as the single parameter. This has a consequence: An IF file rendered with the Java2DDocumentHandler may not look as expected when it was actually generated for the PDF implementation. For implementations that use the same font setup, this restriction does not apply (PDF and PS, for example). Generating the Intermediate Format file is the first step.</p>
<p>The second step is to reparse the file using the <strong>IFParser</strong> which is found in the org.apache.fop.render.intermediate package. The IFParser simply takes an IFDocumentHandler instance against which it generates the appropriate calls. The IFParser is implemented as a SAX ContentHandler so you're free to choose the method for post-processing the IF file(s). You can use XSLT or write SAX- or DOM-based code to manipulate the contents. You can find examples for the Intermediate Format processing in the <a href="http://svn.apache.org/viewvc/xmlgraphics/fop/trunk/fop/examples/embedding/java/embedding/intermediate/">http://svn.apache.org/viewvc/xmlgraphics/fop/trunk/fop/examples/embedding/java/embedding/intermediate/</a> directory in the FOP distribution.</p>
<p>The basic pattern to parse the intermediate format looks like this:</p>
<div class="highlight"><pre><span></span><span class="n">FopFactory</span> <span class="n">fopFactory</span> <span class="o">=</span> <span class="n">FopFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;.&quot;</span><span class="o">).</span><span class="na">toURI</span><span class="o">());</span>

<span class="c1">// Setup output</span>
<span class="n">OutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">FileOutputStream</span><span class="o">(</span><span class="n">pdffile</span><span class="o">);</span>
<span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">BufferedOutputStream</span><span class="o">(</span><span class="n">out</span><span class="o">);</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="c1">//Setup user agent</span>
    <span class="n">FOUserAgent</span> <span class="n">userAgent</span> <span class="o">=</span> <span class="n">fopFactory</span><span class="o">.</span><span class="na">newFOUserAgent</span><span class="o">();</span>

    <span class="c1">//Create IFDocumentHandler instance</span>
    <span class="n">IFDocumentHandler</span> <span class="n">targetHandler</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">mime</span> <span class="o">=</span> <span class="n">MimeConstants</span><span class="o">.</span><span class="na">MIME_PDF</span><span class="o">;</span>
    <span class="n">targetHandler</span> <span class="o">=</span> <span class="n">fopFactory</span><span class="o">.</span><span class="na">getRendererFactory</span><span class="o">().</span><span class="na">createDocumentHandler</span><span class="o">(</span>
            <span class="n">userAgent</span><span class="o">,</span> <span class="n">mime</span><span class="o">);</span>

    <span class="c1">//Setup fonts</span>
    <span class="n">IFUtil</span><span class="o">.</span><span class="na">setupFonts</span><span class="o">(</span><span class="n">targetHandler</span><span class="o">);</span>

    <span class="c1">//Tell the target handler where to write the PDF to</span>
    <span class="n">targetHandler</span><span class="o">.</span><span class="na">setResult</span><span class="o">(</span><span class="k">new</span> <span class="n">StreamResult</span><span class="o">(</span><span class="n">pdffile</span><span class="o">));</span>

    <span class="c1">//Parse the IF file</span>
    <span class="n">IFParser</span> <span class="n">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IFParser</span><span class="o">();</span>
    <span class="n">Source</span> <span class="n">src</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StreamSource</span><span class="o">(</span><span class="n">myIFFile</span><span class="o">);</span>
    <span class="n">parser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">src</span><span class="o">,</span> <span class="n">targetHandler</span><span class="o">,</span> <span class="n">userAgent</span><span class="o">);</span>

<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
    <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>


<p>This example simply reads an intermediate file and renders it to a PDF file. Here IFParser.parse() is used, but you can also just get a SAX ContentHandler by using the IFParser.getContentHandler() method.</p>
<h3 id="concat-if">Concatenating Documents</h3>
<p>This initial example is obviously not very useful. It would be faster to create the PDF file directly (without the intermediate step). As the <a href="http://svn.apache.org/repos/asf/xmlgraphics/fop/trunk/fop/examples/embedding/java/embedding/intermediate/ExampleConcat.java">ExampleConcat.java</a> example shows you can easily parse multiple intermediate files in a row and use the IFConcatenator class to concatenate page sequences from multiple source files to a single output file. This particular example does the concatenation on the level of the IFDocumentHandler interface. You could also do this in XSLT or using SAX on the XML level. Whatever suits your process best.</p>
<h3 id="modifying-if">Modifying Documents</h3>
<p>One of the most important use cases for this format is obviously modifying the intermediate format before finally rendering it to the target format. You can easily use XSLT to process the IF file according to your needs.</p>
<p>There is an XML Schema (located under <a href="http://svn.apache.org/viewvc/xmlgraphics/fop/trunk/fop/src/documentation/intermediate-format-ng/">src/documentation/intermediate-format-ng</a>) that helps you verify that your modified content is correct.</p>
<p>For certain output formats there's a caveat: Formats like AFP and PCL do not support arbitrary transformations on the IF's "viewport" and "g" elements. Possible are only rotations in 90 degree steps and translations.</p>
<h3 id="advanced-if">Advanced Use</h3>
<p>The generation of the intermediate format as well as it parsing process has been designed to allow for maximum flexibility and optimization. So rather than just passing in a StreamResult to IFSerializer's setResult() method, you can also use a SAXResult or a DOMResult. And as you've already seen, the IFParser on the other side allows you to retrieve a ContentHandler instance where you can manually send SAX events to start the parsing process (see <code>getContentHandler()</code>).</p>

      <div class="clear"></div>

	  <div id="footer">
		<div class="copyright">
		  <div style="float:left; padding: 7px;">
			<a title="Apache Software Foundation" href="http://www.apache.org"><img id="asf-feather-logo" alt="Apache Software Foundation" src="/images/asf_logo_url.png" width="200" /></a>
        </div>
		  <p>
			Copyright &copy; 2016 The Apache Software Foundation, Licensed under
			the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.
			<br />
			Apache, Apache XML Graphics, Apache FOP, Apache Batik, the Apache feather logo, and the
			Apache XML Graphics logos are trademarks of <a href="http://www.apache.org">The Apache
			Software Foundation</a>. All other marks mentioned may be trademarks or registered
			trademarks of their respective owners.
			<br />
		  </p>
		</div> 
	  </div>
	
  </body>
</html>